{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1>{% if question %}Editar{% else %}Crear{% endif %} Pregunta</h1>
        <p>Tema: {{ exam.title }}</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="question-form">
        {% csrf_token %}

        <div class="form-group">
            <label for="question_text">Texto de la Pregunta *</label>
            <textarea
                name="question_text"
                id="question_text"
                rows="4"
                placeholder="Escribe aquí el texto de la pregunta..."
                required>{% if question %}{{ question.question_text }}{% endif %}</textarea>
            <small class="form-hint">Escribe una pregunta clara y concisa</small>
        </div>

        <div class="form-group">
            <label for="answer_text">Respuesta *</label>
            <textarea
                name="answer_text"
                id="answer_text"
                rows="3"
                placeholder="Escribe la respuesta a la pregunta..."
                required>{% if answer %}{{ answer.answer_text }}{% endif %}</textarea>
            <small class="form-hint">Esta es la respuesta correcta para la pregunta</small>
        </div>

        <div class="form-group">
            <label for="explanation">Comentario / Explicación (opcional)</label>
            <textarea
                name="explanation"
                id="explanation"
                rows="3"
                placeholder="Añade un comentario o explicación adicional...">{% if question %}{{ question.explanation }}{% endif %}</textarea>
            <small class="form-hint">Opcional: Información adicional o contexto sobre la pregunta</small>
        </div>

        <div class="form-group">
            <label for="image">Imagen (opcional)</label>
            {% if question.image %}
                <div class="current-image" id="currentImageContainer">
                    <img src="{{ question.image.url }}" alt="Imagen actual" id="currentImagePreview">
                    <p>Imagen actual</p>
                    <button type="button" class="btn-delete-image" onclick="confirmDeleteImage()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Eliminar Imagen
                    </button>
                </div>
                <input type="hidden" name="delete_image" id="deleteImageInput" value="0">
            {% endif %}
            <input
                type="file"
                name="image"
                id="image"
                accept="image/*">
            <small class="form-hint">Formatos aceptados: JPG, PNG, GIF (máx. 5MB)</small>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-submit">
                {% if question %}Actualizar Pregunta{% else %}Crear Pregunta{% endif %}
            </button>
            <a href="{% url 'exams:question_manage' exam.id %}" class="btn-cancel">Cancelar</a>
        </div>
    </form>
</div>

<style>
    body {
        background: #f5f5f5;
        overflow-y: auto !important;
    }

    .form-container {
        max-width: 800px;
        margin: 40px auto;
        padding: 40px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .form-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid #ecf0f1;
    }

    .form-header h1 {
        color: #2c3e50;
        margin: 0 0 10px 0;
        font-size: 28px;
    }

    .form-header p {
        color: #7f8c8d;
        margin: 0;
        font-size: 14px;
    }

    .question-form {
        width: 100%;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #2c3e50;
        font-weight: 600;
        font-size: 15px;
    }

    .form-group textarea,
    .form-group input[type="file"] {
        width: 100%;
        padding: 12px;
        border: 2px solid #ecf0f1;
        border-radius: 6px;
        font-size: 14px;
        font-family: Arial, sans-serif;
        transition: border-color 0.3s;
        resize: vertical;
    }

    .form-group textarea:focus {
        outline: none;
        border-color: #7ed321;
    }

    .form-group input[type="file"] {
        padding: 10px;
        cursor: pointer;
    }

    .form-hint {
        display: block;
        margin-top: 6px;
        color: #95a5a6;
        font-size: 12px;
        font-style: italic;
    }

    .current-image {
        margin-bottom: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
        text-align: center;
    }

    .current-image img {
        max-width: 100%;
        max-height: 250px;
        border-radius: 4px;
        margin-bottom: 10px;
    }

    .current-image p {
        margin: 0 0 10px 0;
        color: #7f8c8d;
        font-size: 13px;
    }

    .btn-delete-image {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
    }

    .btn-delete-image:hover {
        background: #c0392b;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    }

    .btn-delete-image svg {
        flex-shrink: 0;
    }

    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 35px;
        padding-top: 25px;
        border-top: 2px solid #ecf0f1;
    }

    .btn-submit,
    .btn-cancel {
        flex: 1;
        padding: 14px 30px;
        border-radius: 6px;
        text-decoration: none;
        text-align: center;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
    }

    .btn-submit {
        background: linear-gradient(to right, #7ed321, #5cb811);
        color: white;
    }

    .btn-submit:hover {
        background: linear-gradient(to right, #6bc21b, #4a9a0f);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(126, 211, 33, 0.3);
    }

    .btn-cancel {
        background: #95a5a6;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-cancel:hover {
        background: #7f8c8d;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .form-container {
            margin: 20px;
            padding: 30px 25px;
        }

        .form-header h1 {
            font-size: 24px;
        }

        .form-group label {
            font-size: 14px;
        }

        .form-group textarea,
        .form-group input[type="file"] {
            font-size: 13px;
        }

        .form-actions {
            flex-direction: column;
        }

        .btn-submit,
        .btn-cancel {
            width: 100%;
        }
    }

    @media (max-width: 480px) {
        .form-container {
            margin: 15px;
            padding: 25px 20px;
        }

        .form-header {
            margin-bottom: 30px;
        }

        .form-header h1 {
            font-size: 20px;
        }

        .form-header p {
            font-size: 13px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            font-size: 13px;
        }

        .form-group textarea,
        .form-group input[type="file"] {
            padding: 10px;
            font-size: 13px;
        }

        .btn-submit,
        .btn-cancel {
            padding: 12px 20px;
            font-size: 14px;
        }
    }
</style>

<script>
    function confirmDeleteImage() {
        if (confirm('¿Estás seguro de que quieres eliminar esta imagen?')) {
            // Marcar para eliminación
            document.getElementById('deleteImageInput').value = '1';

            // Ocultar visualmente la imagen
            const container = document.getElementById('currentImageContainer');
            container.style.opacity = '0.5';
            container.style.pointerEvents = 'none';

            // Cambiar el texto
            const paragraph = container.querySelector('p');
            paragraph.textContent = 'La imagen será eliminada al guardar';
            paragraph.style.color = '#e74c3c';
            paragraph.style.fontWeight = 'bold';

            // Ocultar el botón de eliminar
            const deleteBtn = container.querySelector('.btn-delete-image');
            deleteBtn.style.display = 'none';
        }
    }
</script>
{% endblock %}
